# TODO по Оптимизации и Рефакторингу

Главное правило - дизайн менять нельзя!!
Делаем по шагам!! Я должен провериь что все работало
Не найдобежать в переди поровоза! А то будет много ошибок

## Завершенные Задачи

*   **Рефакторинг и Упрощение:**
    *   [Х] Удалить неиспользуемое в `createStaticFont` (`useFontManager.js`). (Анализ п.2)
    *   [Х] Удалить дублирование `variableSettings` в `handleFontsUploaded` (`useFontManager.js`). (Анализ п.3)
    *   [Х] Вынести утилиты цвета в `utils/colorUtils.js`. (Анализ п.6)
    *   [X] Упростить/оптимизировать загрузку Google Fonts (`Sidebar.jsx` / `googleFontService.js`). (Анализ п.4)
    *   [X] Централизовать управление стилями (`useFontManager`/`FontContext`). (Анализ п.13)
    *   [Х] Провести ревизию зависимостей в `utils`. (Анализ п.15)
*   **Управление Состоянием:**
    *   [Х] Проверить/реализовать `FontContext` и `SettingsContext`. (Анализ п.7, п.12)
    *   [X] Пересмотреть `exportedFont` и `handleExport`. (Анализ п.1)
*   **Оптимизация Производительности:**
    *   [Х] Реализовать `React.lazy` для режимов (`FontPreview.jsx`). (Анализ п.8)
    *   [Х] Переделать анимацию на `requestAnimationFrame` (`VariableFontControls.jsx`). (Анализ п.10)
    *   [Х] Пересмотреть/восстановить `hasSignificantChanges` (`cssGenerator.js`). (Анализ п.14)
*   **Проверка и Удаление Кода:**
    *   [Х] Проверить/удалить `utils/styleBuffer.js`. (Анализ п.5)
    *   [Х] Проверить/обновить fallback-логику (`fontParser.js`). (Анализ п.9)
*   **UI/UX & Frontend Performance**
    *   [X] Оптимизировать рендеринг списков (Waterfall, Glyphs) через виртуализацию. 
*   **Улучшение Надежности:**
    *   [Х] Улучшить обработку ошибок Google Fonts (`googleFontService.js`). (Анализ п.11)

# TODO по Оптимизации и Рефакторингу

Главное правило - дизайн менять нельзя!!
Делаем по шагам!! Я должен провериь что все работало
Не найдобежать в переди поровоза! А то будет много ошибок

## Предложения по Дальнейшему Улучшению

*   [ ] **Рефакторинг `Sidebar.jsx`**: Разбить большой компонент `Sidebar.jsx` на более мелкие, сфокусированные подкомпоненты (например, `FontList`, `ColorSettings`, `TextSettings`, `VariableControlsContainer`) для улучшения читаемости и поддержки.
*   [ ] **Ленивая Загрузка Превью Google Fonts**: Реализовать lazy loading для превью шрифтов Google в сайдбаре, чтобы ускорить его загрузку и отклик.
*   [ ] **Оптимизация Анимации (Throttling)**: Применить троттлинг к обновлению глобального состояния (`handleVariableSettingsChange`) внутри анимационного цикла `VariableFontControls.jsx` для снижения нагрузки на рендеринг.
*   [ ] **Сохранение Состояния**: Реализовать сохранение состояния (список шрифтов, настройки) в `localStorage` или `IndexedDB` для улучшения пользовательского опыта при перезагрузке.
*   [ ] **Профилирование и Тонкая Настройка**: Использовать React DevTools Profiler для выявления и устранения оставшихся узких мест в производительности.
*   [ ] **Динамические Стили Google Fonts**: Загружать информацию о доступных стилях Google Fonts динамически (из `googleFontService.js`?) вместо использования жестко заданной карты `GOOGLE_FONT_STYLES_MAP` в `useFontManager.js`. (См. TODO в `useFontManager.js`)
*   [ ] **Оптимизация `parseFontBuffer`/Воркера**: Пересмотреть логику `parseFontBuffer` и/или воркера (`fontParser.worker.js`), чтобы избежать повторного парсинга в основном потоке, если воркер уже вернул необходимые данные (или чтобы воркер возвращал полный объект). (См. TODO в `fontParser.js`)


TODO в useFontManager.js (динамическая загрузка стилей Google): Можно добавить как задачу на будущее в PROJECT_OPTIMIZATION_TODO.md.
TODO в fontParser.worker.js (стили из OS/2): Низкий приоритет, можно пока игнорировать.
TODO в glyphUtils.js (лигатуры GSUB): Очень сложная тема, вероятно, выходит за рамки текущих задач. Игнорировать.

